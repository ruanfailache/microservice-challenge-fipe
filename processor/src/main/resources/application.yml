quarkus:
  application:
    name: fipe-processor
  http:
    port: 8081
  
  rest-client:
    fipe-api:
      url: https://parallelum.com.br/fipe/api/v1
      scope: jakarta.inject.Singleton
      connect-timeout: 10000
      read-timeout: 30000
    user-auth-service:
      url: http://localhost:8082
      scope: jakarta.inject.Singleton
      connect-timeout: 5000
      read-timeout: 10000
  
  datasource:
    db-kind: postgresql
    username: fipe
    password: fipe
    jdbc:
      url: jdbc:postgresql://localhost:5432/fipe_processor
  
  hibernate-orm:
    database:
      generation: none
    log:
      sql: false
  
  liquibase:
    migrate-at-start: true
    change-log: db/changelog/db.changelog-master.xml
  
  smallrye-openapi:
    path: /swagger
  
  swagger-ui:
    always-include: true
    path: /swagger-ui
  
  log:
    level: INFO
    category:
      "com.fipe":
        level: INFO
    console:
      format: "%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n"

kafka:
  bootstrap:
    servers: localhost:9092

mp:
  messaging:
    incoming:
      vehicle-data-in:
        connector: smallrye-kafka
        topic: vehicle-data
        value:
          deserializer: org.apache.kafka.common.serialization.StringDeserializer
        key:
          deserializer: org.apache.kafka.common.serialization.StringDeserializer
        auto:
          offset:
            reset: earliest
        group:
          id: fipe-processor-group
        enable:
          auto:
            commit: false  # Manual commit for better control
        failure-strategy: dead-letter-queue
        dead-letter-queue:
          topic: vehicle-data-dlq
          max-retries: 3
          retry-backoff: 10000  # 10 seconds between retries
        throttled:
          unprocessed-record-max-age:
            ms: 60000  # 1 minute
      
      vehicle-data-dlq:
        connector: smallrye-kafka
        topic: vehicle-data-dlq
        value:
          deserializer: org.apache.kafka.common.serialization.StringDeserializer
        key:
          deserializer: org.apache.kafka.common.serialization.StringDeserializer
        group:
          id: fipe-processor-dlq-group

  fault-tolerance:
    fipe-api-circuit-breaker:
      request-volume-threshold: 10
      failure-ratio: 0.5
      delay: 30000  # 30 seconds
      success-threshold: 5
